<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clock</title>
    <!-- Linking Font Awesome for the icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>

    <style>

        .clock-icon {
        font-family: 'WeatherIcons';
        font-size: 24px; /* or any size you prefer */
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;  /* To ensure no scroll appears */
        }


        :root {
            --text-color: #ffffff;  /* Default color, which can be changed */
            --text-faded: #bbbbbb;
            --text-lighter: #ffffff;
            --main-color: #251040;
            --main-lighter: #ff00ff;
            --shadow-color: #000000;
            --main-bg-color: #100320;
            --baseFontSizeLarge: 250px;
            --baseFontSizeMedium: 100px;
        }

        .dropdown-content {
            z-index: 1000; /* Arbitrary large number */
        }

        .degree{
            z-index: -1000;
        }


        body {
            background-color: var(--main-bg-color);
            font-family: 'Source code pro', sans-serif;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--main-color);
            color: var(--text-color);
            width: 100%;
            box-sizing: border-box;
        }

        .left-side,
        .right-side {
            display: flex;
            align-items: center;
        }

        .icon-btn, .dropdown-content a {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            font-size: 19px;
            color: var(--text-color);
            transition: background-color 0.3s;
        }

        .icon-btn:hover, .dropdown-content a:hover {
            background-color: var(--main-lighter);
        }

        .gradient-line {
            height: 40px;
            width: 2px;
            background: linear-gradient(to bottom, transparent, var(--text-faded), transparent);
        }

        .display-btn-group {
            position: relative;
            font-size: 18px;
            padding: 0 30px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            height: 60px;
        }

        .display-btn-group:hover {
            background-color: var(--main-lighter);
        }

        .btn-group {
            position: relative;
        }

        /* Dropdown styles */
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%; 
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        }

        .dropdown-content a {
            width: 100%;  /* Take full width of the dropdown */
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--text-color);
            border: none;
            font-size: 19px;
            color: var(--text-color);
            transition: background-color 0.3s;
            text-decoration: none; /* Removes any underline from the link */
        }

        /* Default color for icons inside the dropdown */
        .dropdown-content i, .dropdown-content a{
            color: var(--main-lighter);
        }

        /* Change color to white when the icon is hovered */
        .dropdown-content a:hover, .dropdown-content a:hover i,
        .dropdown-content button:hover i {
            color: var(--text-color);
        }


        .display-btn-group:hover .dropdown-content,
        .btn-group:hover .dropdown-content {
            display: block;
        }

        .settings-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to right, rgba(0,0,0,0.7), transparent, transparent);
            z-index: 999; /* Lower z-index than the modal */
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 50px;
            left: 50px;
            z-index: 1000;
        }

        .color-text, .color-text-link {
            font-family: 'Source code pro', sans-serif;
            font-size: var(--custom-text-size, 18px);
            color: var(--text-color);
        }

        .screen-text-small {
            font-family: 'Source code pro', sans-serif;
            font-size: var(--custom-text-size, 21px);
            color: var(--text-color);
        }

        .color-text-link{
            text-decoration: underline;
        }
        .content-screens {
            display: grid;
            place-items: center;   /* Center in both axis */
            height: 93.9vh;
        }
        .centered-container {
            width: fit-content; /* This will make the container as wide as its content */
            margin-left: auto; /* These two lines will center the container horizontally */
            margin-right: auto;
            text-align: left; /* This ensures that the text inside is left-aligned */
        }
        .screen-text-large, .screen-text-medium {
            font-family: 'Source code pro', sans-serif;
            color: var(--text-color);           /* White text color */
            text-align: center;    /* Center aligned text */
            padding: 20px;         /* Padding around the text */
            text-shadow: 0 4px 8px rgba(0, 0, 0, 1); /* Subtle shadow for depth */
            margin: 20px;          /* Margin around the container */
            font-variant-numeric: tabular-nums oldstyle-nums;
            text-transform: full-width;
        }

        .screen-text-large {
            font-size: 22vh;/
        }

        .screen-text-medium {
            font-size: 10vh;
        }

        .modal-content {
            width: auto; /* Adjust based on content */
            margin: 0; /* Remove auto margin */
            padding: 20px;
            background: var(--main-color);
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        }



        .setting-item {
            margin-bottom: 20px;
        }

        .setting-item label {
            color: var(--text-color);
            margin-right: 10px;
        }

        .close-btn {
            color: var(--text-color);
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .close-btn:hover {
            top: 8px;
            right: 8px;
            font-size: 1.8rem;
        }

        .settings-select {
            background-color: white;
            height:500px;
            width:500px;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: inline-block;
            width: 100%;
        }

        .screen-content {
            display: none;
        }

        #fa-clock-content {
            display: block; /* Display the clock screen by default */
        }
        .screen {
            display: none;
            width: 100vw;
            height: 100vh;
            align-items: center;
            justify-content: center;
            background-color: var(--background-color);
        }

        .stopwatch {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Arial', sans-serif;
        }

        #timeDisplay {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stopwatchButton {
            background-color: var(--text-color);
            margin: 15px;
            width: 80px;
            height: 80px;
            font-size: 2.5em;
            border: none;
            color: var(--main-bg-color);
        }

        .stopwatchButton:hover {
            background-color: var(--text-faded);
            width: 80px;
            height: 80px;
            font-size: 2.5em;
        }

        .stopwatch {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Arial', sans-serif;
        }

        .stopwatchButtonContainer {
            display: flex;
            flex-direction: row;
            align-items: left;
        }

        #timeDisplay {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .bigSlider {
            -webkit-appearance: none;
            width: 60vw;
            height: 25px;
            background: var(--text-faded);
            outline: none;
            -webkit-transition: .2s;
            transition: opacity .2s
        }

        .bigSlider:hover {
            background: var(--text-color);
        }

        .bigSlider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 25px;
          height: 25px;
          background: var(--main-color);
          cursor: pointer;
        }

        .small-slider {
            -webkit-appearance: none;
            width: 150px;
            height: 10px;
            background: var(--main-bg-color);
            outline: none;
            -webkit-transition: .2s;
            transition: opacity .2s
        }

        .small-slider:hover:-webkit-slider-thumb {
            background: var(--text-color);
        }

        .small-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 10px;
          height: 10px;
          background: var(--text-color);
          cursor: pointer;
        }

        .select2 {
            font-family: 'Source code pro', sans-serif;
            width: 100px;
        }

        .select2 select {
            font-family: 'Source code pro', sans-serif;\
            width: 100px;
        }

        .selection-container{
            width: 250px;
        }

        /*------ Style 1 ------*/
        .color-select {
          -webkit-appearance: none;
          -moz-appearance: none;
          appearance: none;
          width: 50px;
          height: 25px;
          background-color: transparent;
          border-radius: 20px;
          border-width: 2px;
          border-color: var(--main-bg-color);
          cursor: pointer;
        }
        .color-select::-webkit-color-swatch {
          border-radius: 20px;
          border: none;
        }
        .color-select::-moz-color-swatch {
          border-radius: 20px;
          border: none;
        }

        .modal-body{
          height: 75vh;
          overflow-y: auto;
          width: 45vh;
        }

        /* width */
        ::-webkit-scrollbar {
          width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
          background: transparent; 
        }
 
        /* Handle */
        ::-webkit-scrollbar-thumb {
          background: var(--main-bg-color); 
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
          background: var(--main-bg-color); 
        }

        .fade-out {
            animation-name: fadeOut;
            animation-timing-function: ease-out;
            animation-fill-mode: forwards;
            animation-duration: 1s;
        }

        @keyframes fadeOut {
            100% {
                opacity: 0;
                visibility: hidden;
            }
        }

    </style>
</head>

<body>
    <div id="loadingScreen" style="position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(255, 255, 255, 0.9); display:flex; align-items:center; justify-content:center; z-index:10000;">
        <div>Loading...</div>
    </div>

    <canvas id="clock" width="16" height="16" style="display:none;"></canvas>
    <!-- Background Overlay -->
    <div id="settingsOverlay" class="settings-overlay"></div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="settings-modal">
         <div class="modal-content">
            <div class="modal-header">
                <h2 class="color-text" style="--custom-text-size: 28px;">Settings</h2>
                <button id="closeSettings" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-item"><button id="saveThemeBtn">Save Theme</button>   <select id="savedSettingsListDropdown"></select>   <button id="deleteThemeButton">Delete Current Theme</button>
                <h2 class="color-text" style="--custom-text-size: 12px;">name "default" for default</h2></div>

                <h2 class="color-text" style="--custom-text-size: 19px;">Time</h2>
                <div class="setting-item">
                    <!-- seconds Checkbox -->
                    <input type="checkbox" id="useSeconds">
                    <label for="useSeconds">Use Seconds</label>
                </div>
                <div class="setting-item">
                    <!-- 24 hour Checkbox -->
                    <input type="checkbox" id="use24hrs">
                    <label for="use24hrs">Use 24 hour</label>
                </div>
                <div class="setting-item">
                    <!-- truncate zero Checkbox -->
                    <input type="checkbox" id="truncateZero" checked>
                    <label for="truncateZero">disable Leading Zero</label>
                </div>
                <h2 class="color-text" style="--custom-text-size: 19px;">Date</h2>
                <!-- Toggle Entire Date -->
                <div class="setting-item">
                    <input class="checkbox" type="checkbox" id="toggleDate" checked>
                    <span class="checkbox-custom"></span>
                    <label for="toggleDate">Show Date</label>
                </div>
                <!-- seperator Entire Date -->
                <div class="setting-item">
                    <input class="checkbox" type="checkbox" id="toggleSep" checked>
                    <span class="checkbox-custom"></span>
                    <label for="toggleSep">Toggle Comma</label>
                </div>
                <div style="width: 100%; display: flex; flex-direction: row;">
                    <div>
                        <!-- Date Format -->
                        <div class="setting-item">
                            <h2 class="color-text" style="--custom-text-size: 15px;">Date</h2>
                            <input type="radio" name="dateFormat" value="0" id="dateRadioOff"> <label for="dateRadioOff">Off</label><br>
                            <input type="radio" name="dateFormat" value="1" checked id="dateRadioOn"> <label for="dateRadioOn">On</label><br>
                            <br>
                        </div>
                        <!-- Weekday Format -->
                        <div class="setting-item">
                            <h2 class="color-text" style="--custom-text-size: 15px;">Weekday</h2>
                            <input type="radio" name="weekdayFormat" value="0" id="weekRadio0" checked> <label for="weekRadio0">Off</label><br>
                            <input type="radio" name="weekdayFormat" value="1" id="weekRadio1">         <label for="weekRadio1">Short</label><br>
                            <input type="radio" name="weekdayFormat" value="2" id="weekRadio2">         <label for="weekRadio2">Long</label><br>
                        </div>
                    </div>
                    <div>
                        <!-- Month Format -->
                        <div class="setting-item">
                            <h2 class="color-text" style="--custom-text-size: 15px;">Month</h2>
                            <input type="radio" name="monthFormat" value="0" id="monthRadio0">         <label for="monthRadio0">Off</label><br>
                            <input type="radio" name="monthFormat" value="1" id="monthRadio1" checked> <label for="monthRadio1">Short</label><br>
                            <input type="radio" name="monthFormat" value="2" id="monthRadio2">         <label for="monthRadio2">Long</label><br>
                        </div>
                        <!-- Year Format -->
                        <div class="setting-item">
                            <h2 class="color-text" style="--custom-text-size: 15px;">Year</h2>
                            <input type="radio" name="yearFormat" value="0" id="yearRadio0">         <label for="yearRadio0">Off</label><br>
                            <input type="radio" name="yearFormat" value="1" id="yearRadio1">         <label for="yearRadio1">Short</label><br>
                            <input type="radio" name="yearFormat" value="2" id="yearRadio2" checked> <label for="yearRadio2">Long</label><br>
                        </div>
                    </div>
                </div>

                <h2 class="color-text" style="--custom-text-size: 19px;">Colors</h2>
                <div class="setting-item">
                    <input class="color-select" type="color" id="mainColorPicker" name="mainColorPicker" value="#ff0000">
                    <label class="color-text" for="mainColorPicker">choose main color</label>
                </div>
                <div class="setting-item">
                    <input class="color-select" type="color" id="textColorPicker" name="textColorPicker" value="#ff0000">
                    <label class="color-text" for="textColorPicker">Choose an alternate color</label>
                </div>
                <div class="setting-item">
                    <input class="color-select" type="color" id="bgColorPicker" name="bgColorPicker" value="#ff0000">
                    <label class="color-text" for="bgColorPicker">Choose background color</label>
                </div>
                <h2 class="color-text" style="--custom-text-size: 19px;">Text</h2>
                <div class="setting-item">
                    <!-- Bold Checkbox -->
                    
                    <input class="checkbox" type="checkbox" id="textBold">
                    <label for="textBold">Bold</label>
                </div>
                <div class="setting-item">
                    <!-- Character Spacing Slider -->
                    <input class="small-slider" type="range" id="characterSpacing" min="-100" max="100" value="0">
                    <label for="characterSpacing">Character Spacing</label>
                    
                </div>
                <div class="setting-item">
                    <!-- Text Size Multiplier Slider -->
                    <input class="small-slider" type="range" id="textSizeMultiplier" min="0.3" max="2" step="0.01" value="0.9">
                    <label for="textSizeMultiplier">Text Size Multiplier:</label>
                    
                </div>
                <div class="setting-item">
                    <!-- Text Opacity Slider -->
                    <input class="small-slider" type="range" id="textOpacity" min="0" max="1" step="0.1" value="1">
                    <label for="textOpacity">Text Opacity:</label>
                    
                </div>
                <div class="setting-item">
                    <div class="selection-container">
                        <label class="color-text" for="fontSelector">Select a font:</label>
                        <select id="font" class="select2"></select>
                    </div>
                </div>
                <h2 class="color-text" style="--custom-text-size: 19px;">Shadows</h2>
                <div class="setting-item">
                    <input class="color-select" type="color" id="shadowColor" name="shadowColorPicker" value="#000000">
                    <label class="color-text" for="shadowColor">color</label>
                </div>
                <div class="setting-item">                
                    <input class="small-slider" type="range" id="shadowOpacity" min="0" max="1" step="0.1" value="0.5">
                    <label class="color-text" for="shadowOpacity">opacity</label>
                </div>
                <div class="setting-item">                
                    <input class="small-slider" type="range" id="shadowAngle" min="0" max="360" value="45" step="7.2">
                    <label class="color-text" for="shadowAngle">angle</label>
                </div>
                <div class="setting-item">                
                    <input class="small-slider" type="range" id="shadowDistance" min="0" max="500" value="0">
                    <label class="color-text" for="shadowColor">distance</label>
                </div>
                <div class="setting-item">                
                    <input class="small-slider" type="range" id="shadowRadius" min="0" max="200" value="10">
                    <label class="color-text" for="shadowRadius">radius</label>
                </div>
                <h2 class="color-text" style="--custom-text-size: 19px;">Other</h2>
                <div class="setting-item">
                    <label class="color-text" for="fontApiKey">Font API Key:</label>
                    <input type="text" id="fontApiKey" name="fontApiKey" placeholder="Enter your API Key">
                </div>
                <div class="setting-item">
                    <label class="color-text" for="weatherApiKey">Weather API Key:</label>
                    <input type="text" id="weatherApiKey" name="weatherApiKey" placeholder="Enter your API Key">
                    <a href="https://developers.google.com/fonts/docs/developer_api"><p class="color-text-link">Get font API key</p></a>
                    <a href="https://www.educative.io/answers/how-to-get-the-openweather-api-key"><p class="color-text-link">Get weather API key</p></a>
                </div>
                <div class="setting-item">
                    <button id="updateLocationBtn">Update Location</button>
                </div>
                <a href="https://github.com/baconlover209/Clock-Html-File"><p class="color-text-link">Github page</p></a>
            </div>

        </div>
    </div>

    
    
    <div class="top-bar">
        <!-- Left Side: Display and Swap Screen Button -->
        <div class="left-side">
            <!-- Display (e.g., current time) with dropdown -->
            <div class="display-btn-group">
                <div class="screen-text-small" id="displayContent" style="--custom-text-size: 21px;"><p>Loading Time...</p></div>
                <!-- Dropdown content for the Display -->
                <div class="dropdown-content">
                        <a href="#" class="screen-text-small" style="--custom-text-size: 21px;" id="displayTimeOption">12:00 AM</a>
                        <a href="#" class="screen-text-small" style="--custom-text-size: 21px;" id="displayDateOption">Jan 1</a>
                        <a href="#" class="screen-text-small" style="--custom-text-size: 21px;" id="displayTimerOption">00:00:00</a>
                        <a href="#" class="screen-text-small" style="--custom-text-size: 21px;" id="displayWeatherOption"><i class="fas fa-cloud-sun" aria-hidden="true"></i>-weather</a>
                        <a href="#" class="screen-text-small" style="--custom-text-size: 21px;" id="displayRainOption"><i class="wi wi-rain"></i>-N/A%</a>
                        <a href="#" class="screen-text-small" style="--custom-text-size: 21px;" id="displayTempOption"><i class="wi wi-thermometer"></i>-N/A</i></a>
                </div>
            </div>

            <!-- Gradient Line -->
            <div class="gradient-line"></div>
            <!-- Swap Screen Button - using a clock button as the initial icon -->
            <div class="btn-group"> 
                <button class="icon-btn" id="dropdownBtn">
                    <i class="fas fa-clock" aria-hidden="true" id="selectedIcon"></i>
                </button>
                <!-- Dropdown content for the Swap Screen Button -->
                <div class="swap-screen-container">
                    <div class="dropdown-content">
                        <a href="#" data-icon="fa-clock">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                        </a>
                        <a href="#" data-icon="fa-stopwatch">
                            <i class="fas fa-stopwatch" aria-hidden="true"></i>
                        </a>
                        <a href="#" data-icon="fa-hourglass">
                            <i class="fas fa-hourglass" aria-hidden="true"></i>
                        </a>
                        <a href="#" data-icon="fa-cloud-sun">
                            <i class="fas fa-cloud-sun" aria-hidden="true"></i>
                        </a>
                        <a href="#" data-icon="fa-layer-group">
                            <i class="fas fa-layer-group" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </div>
            <!-- Another Gradient Line after the play icon -->
            <div class="gradient-line"></div>
        </div>
        <!-- Right Side: Settings Icon -->
        <div class="right-side">
            <!-- Gradient Line -->
            <div class="gradient-line"></div>
            <!-- Settings Icon -->
            <button class="icon-btn" id="settings-btn">
                <i class="fas fa-cog" aria-hidden="true"></i>
            </button>
        </div>
    </div>
    
        <div class="content-screens">
            <div id="fa-clock-content" class="screen-content">
                <div class="centered-container">
                    <span class="screen-text-large" id="currentTime">Loading time...</span>
                    <br></br>
                    <span class="screen-text-medium" id="currentDate">Loading date...</span>
                </div>
            </div>
            <div id="fa-stopwatch-content" class="screen-content">
                <div class="stopwatch">
                    <div class="centered-container">
                        <div class="screen-text-large" id="stopwatchDisplay">00:00:00</div>
                    </div>
                    <div class="stopwatchButtonContainer">
                        <button id="startStopBtn" class="stopwatchButton" onclick="startStopwatch()"><i class="fas fa-play"></i></button>
                        <button id="stopResetBtn" class="stopwatchButton" onclick="stopOrResetStopwatch()"><i class="fas fa-stop"></i></button>
                    </div>
                </div>
            </div>
            <div id="fa-hourglass-content" class="screen-content">
                <div id="timer" class="screen-text-large">
                    <div class="centered-container">
                        <span id="timerHours">00:00:00</span>
                    </div>
                </div>
                <div>
                    <input type="range" class="bigSlider" id="logSlider" min="80000" max="960000" value="80000">
                    <button id="startTimerBtn" class="stopwatchButton"><i class="fas fa-play"></i></button>
                    <button id="stopTimerBtn" class="stopwatchButton"><i class="fas fa-stop"></i></button>
                    <button id="resetTimerBtn" class="stopwatchButton"><i class="fas fa-redo-alt"></i></button>
                </div>
            </div>
            <div id="fa-cloud-sun-content" class="screen-content">
                <div>
                    <div class="screen-text-medium" id="weather-display"></div>
                    <div class="screen-text-medium" id="rain-chance-display"></div>
                    <span class="degree"><div class="screen-text-medium" id="temperature-display"></div></span>

                </div>
            </div>
            <div id="fa-layer-group-content" class="screen-content">
                <div class="screen-text-large">Nothing here...</div>
            </div>
        </div>

    <script>

        document.getElementById('fontApiKey').addEventListener('input', function () {
          let apiKey = this.value;
          localStorage.setItem('fontApiKey', apiKey);

          // Store the API key to use it in your API calls
        });
        let fontApiKey = localStorage.getItem('fontApiKey');

        const fontSelect = document.getElementById('font');

        // Initialize Select2
        $('.select2').select2({
            theme: 'bootstrap',
            width: '100%',
            placeholder: 'Select a font'
        });

        // Fetch Google Fonts
        fetch('https://www.googleapis.com/webfonts/v1/webfonts?key=' + fontApiKey)
            .then(response => response.json())
            .then(data => {
                data.items.sort((a, b) => a.family.localeCompare(b.family))
                    .forEach(font => {
                        const option = document.createElement('option');
                        option.value = font.family;
                        option.textContent = font.family;
                        fontSelect.appendChild(option);
                    });

                // Load fonts dynamically
                const fontLinks = data.items.map(font => `<link href="https://fonts.googleapis.com/css?family=${font.family.replace(/ /g, '+')}" rel="stylesheet">`).join('');
                document.head.innerHTML += fontLinks;

                    const link = document.createElement('link');
                    link.href = `https://fonts.googleapis.com/css?family=Major+Mono+Display`;
                    link.rel = 'stylesheet';
                    document.head.appendChild(link);
                    link.onload = () => {
                        fontSelect.value = 'Source Code Pro';
                        updateStyles();
                    }
            });


        fontSelect.addEventListener('change', () => {
            const font = fontSelect.value;
            const link = document.createElement('link');
            link.href = `https://fonts.googleapis.com/css?family=${font.replace(/ /g, '+')}`;
            link.rel = 'stylesheet';
            document.head.appendChild(link);
            link.onload = () => updateStyles();
        });
        fontSelect.addEventListener('input', updateStyles);
        $('#font.select2').on('select2:select', updateStyles);

        function updateStyles() {
            const font = fontSelect.value;
            ['.screen-text-large', '.screen-text-medium'].forEach(selector => {
                document.querySelectorAll(selector).forEach(element => {
                    element.style.fontFamily = `'${font}', sans-serif`; 
                });
            });
        }


    </script>
    <script>
       
        let displayOptionGlobal = 'time';

          const mainColor = getComputedStyle(document.documentElement).getPropertyValue('--main-color').trim();
          document.getElementById('mainColorPicker').value = mainColor;

          const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
          document.getElementById('textColorPicker').value = textColor;

          const bgColor = getComputedStyle(document.documentElement).getPropertyValue('--main-bg-color').trim();
          document.getElementById('bgColorPicker').value = bgColor


        document.addEventListener("DOMContentLoaded", function () {

          updateDisplayContent('time');

          toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81));



          document.getElementById('displayTimeOption').addEventListener('click', function (e) {
            e.preventDefault();
            displayOptionGlobal = 'time';
            updateDisplayContent('time');

          });

          document.getElementById('displayTimerOption').addEventListener('click', function (e) {
            e.preventDefault();
            displayOptionGlobal = 'timer';
            updateDisplayContent('timer');

          });

          document.getElementById('displayWeatherOption').addEventListener('click', function (e) {
            e.preventDefault();
            displayOptionGlobal = 'weather';
            updateDisplayContent('weather');

          });

          document.getElementById('displayRainOption').addEventListener('click', function (e) {
            e.preventDefault();
            displayOptionGlobal = 'rain';
            updateDisplayContent('rain');

          });

          document.getElementById('displayTempOption').addEventListener('click', function (e) {
            e.preventDefault();
            displayOptionGlobal = 'temp';
            updateDisplayContent('temp');

          });

          document.getElementById('displayDateOption').addEventListener('click', function (e) {
            e.preventDefault();
            displayOptionGlobal = 'date';
            updateDisplayContent('date');

          });

          loadSettingsFromList('default');

          requestLocationPermission();
        });
        window.onload = function() {
            setTimeout(() => {
                const loadingScreen = document.getElementById("loadingScreen");
                loadingScreen.classList.add("fade-out");
            }, 3000); // wait for 1 second (1000 milliseconds) after everything is loaded
        };


        // JavaScript for interactions and other functionality
        // Fetch all dropdown items
        const dropdownItems = document.querySelectorAll('.swap-screen-container .dropdown-content a');

        // Function to handle the click event on a dropdown item
        function handleIconChange(event) {
          event.preventDefault();

          // Get the icon class from the clicked item
          const iconClass = event.currentTarget.getAttribute('data-icon');

          // Fetch the icon inside the dropdown button and update its class
          const selectedIcon = document.getElementById('selectedIcon');
          selectedIcon.className = `fas ${iconClass}`;
        }

        // Add the click event listener to each dropdown item
        dropdownItems.forEach(item => item.addEventListener('click', handleIconChange));

        // Open and close the settings modal
        const settingsButton = document.getElementById('settings-btn');
        const closeButton = document.getElementById('closeSettings');

        const settingsOverlay = document.getElementById('settingsOverlay');
        const settingsModal = document.getElementById('settingsModal');

        settingsButton.addEventListener('click', () => {
          settingsOverlay.style.display = 'block';
          settingsModal.style.display = 'block';
        });

        closeButton.addEventListener('click', () => {
          settingsOverlay.style.display = 'none';
          settingsModal.style.display = 'none';
        });

        function rgbToHex(r, g, b) {
          let hex = (r << 16 | g << 8 | b).toString(16);
          return "#" + ("000000" + hex).slice(-6);
        }

        function hexToRGB(hex) {
          let bigint = parseInt(hex.slice(1), 16);
          let r = (bigint >> 16) & 255;
          let g = (bigint >> 8) & 255;
          let b = bigint & 255;
          return [r, g, b];
        }

        function toVariable(variableName, value) {
          document.documentElement.style.setProperty(variableName, value);
        }

        function mix(base, blend, factor) {
          return base + factor * (blend - base);
        }

        function hexMix(hex1, hex2, factor) {
          const [r1, g1, b1] = hexToRGB(hex1);
          const [r2, g2, b2] = hexToRGB(hex2);
          const r = Math.round(mix(r1, r2, factor));
          const g = Math.round(mix(g1, g2, factor));
          const b = Math.round(mix(b1, b2, factor));
          return rgbToHex(r, g, b);
        }

        function varMix(var1, var2, factor) {
          const hex1 = getComputedStyle(document.documentElement).getPropertyValue(var1).trim();
          const hex2 = getComputedStyle(document.documentElement).getPropertyValue(var2).trim();
          return hexMix(hex1, hex2, factor);
        }

        function hexVarMix(hex, varName, factor) {
          const hex2 = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
          return hexMix(hex, hex2, factor);
        }

        // Get reference to the color input
        const mainColorPicker = document.getElementById('mainColorPicker');
        const debouncedlighten = debounce(toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81)), 1000); // 200ms delay

        function modifyColors(){
            toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81));
            
            toVariable('--text-lighter', hexVarMix('#ffffff', '--text-color', 0.81));
            toVariable('--text-faded', varMix('--main-color', '--text-color', 0.81));

            toVariable('--main-bg-lighter', hexVarMix('#ffffff', '--main-bg-color', 0.81));

        }
        setInterval(modifyColors, 100);
        // Listen for changes in the color picker
        mainColorPicker.addEventListener('input', (event) => {
          // Set the new color to the CSS variable
          toVariable('--main-color', event.target.value);

          // Convert the new color value to RGB and set it to the new RGB variable
          //toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81));
        });

        // Get reference to the color input
        const textColorPicker = document.getElementById('textColorPicker');

        // Listen for changes in the color picker
        textColorPicker.addEventListener('input', (event) => {
          // Set the new color to the CSS variable
          toVariable('--text-color', event.target.value);

          // Convert the new color value to RGB and set it to the new RGB variable
          //toVariable('--text-lighter', hexVarMix('#ffffff', '--text-color', 0.81));
          //toVariable('--text-faded', varMix('--main-color', '--text-color', 0.81));
        });

        // Get reference to the color input
        const bgColorPicker = document.getElementById('bgColorPicker');

        // Listen for changes in the color picker
        bgColorPicker.addEventListener('input', (event) => {
          // Set the new color to the CSS variable
          toVariable('--main-bg-color', event.target.value);

          // Convert the new color value to RGB and set it to the new RGB variable
          //toVariable('--main-bg-lighter', hexVarMix('#ffffff', '--main-bg-color', 0.81));
        });



        mainColorPicker.addEventListener('input', (event) => {
          // Set the new color to the CSS variable
          toVariable('--main-color', event.target.value);

          // Convert the new color value to RGB and set it to the new RGB variable
          //toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81));
        });


        function getAMPM(callback) {
          getTime((time, ampmValue) => {
            callback(ampmValue);
          }, false, false, true);
        }

        // Usage:
        getAMPM(ampmValue => {
          console.log(ampmValue); // Will print either "AM" or "PM"
        });

        // Usage:
        getTime((time) => {
          console.log(time); // Will print the time in desired format
        }, false, true, true, true);

        console.log(getAMPM()); // will print either "AM" or "PM" depending on the current time


        let shouldUse24HourG = false;
        let shouldIncludeSecondsG = false;
        let truncateLeadingZeroG = true;


        // Your getTime function here...
        async function getTime(shouldUse24Hour = shouldUse24HourG, shouldIncludeSeconds = shouldIncludeSecondsG, truncateLeadingZero = truncateLeadingZeroG) {
          let response = await fetch('https://worldtimeapi.org/api/ip');
          let data = await response.json();

          let datetime = new Date(data.datetime);
          let options = {
            hour: '2-digit',
            minute: '2-digit',
            timeZone: data.timezone,
            hour12: !shouldUse24Hour
          };

          if (shouldIncludeSeconds) options.second = '2-digit';

          let timeStr = datetime.toLocaleTimeString([], options);

          // If truncating leading zeros and using 12-hour format
          if (truncateLeadingZero && !shouldUse24Hour) {
            timeStr = timeStr.replace(/^0+/, '');
          }

          return timeStr;
        }





        // Function to update time
        async function updateTime() {
          let time = await getTime(shouldUse24HourG, shouldIncludeSecondsG, truncateLeadingZeroG); // 12-hour format, seconds, truncate leading zero
          document.getElementById('currentTime').textContent = time;
        }
        updateTime();
        setInterval(updateTime, 1000);

        async function updateTimeSmall() {
          if (displayOptionGlobal === 'time') {
            let time = await getTime(false, false, true); // 12-hour format, no seconds, truncate leading zero
            document.getElementById('displayContent').textContent = time;
            document.getElementById('displayTimeOption').textContent = time;
          }
        }
        // Call the updateTime function when the page loads and every minute thereafter
        updateTime();
        const smallTimeInterval = setInterval(updateTimeSmall, 1000);

        async function getDate(weekdayFormat, dateFormat, monthFormat, yearFormat, sep) {
        try {
            const response = await fetch('https://worldtimeapi.org/api/ip');
            const data = await response.json();

            let weekday = "";
            let date = "";
            let month = "";
            let year = "";

            let weekdaySep = " ";
            let dateSep = " ";
            let monthSep = " ";
            let yearSep = " ";



            switch (sep) {
                case 1:
                    weekdaySep = ", ";
                    yearSep = ", ";
                    break;
                default:
                    break;  // 0 means disabled
            }

            if (!data.datetime) {
                console.error("API did not return the expected date format.");
                return;
            }

            const dateObj = new Date(data.datetime);
            let formattedDate = "";

            switch (weekdayFormat) {
                case 1:
                    weekday += dateObj.toLocaleString('en-US', { weekday: 'short' }) + weekdaySep;
                    break;
                case 2:
                    weekday += dateObj.toLocaleString('en-US', { weekday: 'long' }) + weekdaySep;
                    break;
                default:
                    break;  // 0 means disabled
            }

            if (dateFormat === 2 || dateFormat === 1) {
                date += dateObj.getDate();
            }


            switch (monthFormat) {
                case 1:
                    month += dateObj.toLocaleString('en-US', { month: 'short' }) + ' ';
                    break;
                case 2:
                    month += dateObj.toLocaleString('en-US', { month: 'long' }) + ' ';
                    break;
                default:
                    break;  // 0 means disabled
            }

            switch (yearFormat) {
                case 1:
                    year += yearSep + String(dateObj.getFullYear()).slice(-2);
                    break;
                case 2:
                    year += yearSep + dateObj.getFullYear();
                    break;
                default:
                    break;  // 0 means disabled
            }

            formattedDate += weekday + month + date + year;


            return formattedDate.trim();  // Remove any extra trailing space and return

        } catch (error) {
            console.error("Failed to fetch the date from the API:", error);
        }
    }

    // Example usage
    getDate(0, 1, 1, 0, 1).then(result => {
        console.log(result);  // E.g., "Monday Aug 2023"
    });




        document.addEventListener('DOMContentLoaded', function () {
          const dropdownContentElements = document.querySelectorAll('.swap-screen-container .dropdown-content');

          dropdownItems.forEach(item => {
            item.addEventListener('click', function (e) {
              e.preventDefault();

              // Hide all screens
              document.querySelectorAll('.screen-content').forEach(screen => {
                screen.style.display = 'none';
              });

              // Get the corresponding screen's ID from the data attribute
              const screenId = this.getAttribute('data-icon') + '-content';

              // Show the selected screen
              const selectedScreen = document.getElementById(screenId);
              if (selectedScreen) {
                selectedScreen.style.display = 'block';
              }
            });
          });
        });

        let stopwatchInterval;
        let elapsedTime = 0; // time in milliseconds
        let isStopwatchRunning = false;
        let hasTimeElapsed = false;
        let isRunning = false;

        const stopwatchDisplay = document.getElementById('timeDisplay');
        const startStopBtn = document.getElementById('startStopBtn');
        const stopResetBtn = document.getElementById('stopResetBtn');

        startStopBtn.addEventListener('click', function () {
          if (!isRunning) {
            startStopwatch();
            this.innerHTML = '<i class="fas fa-pause"></i>';
          } else {
            stopStopwatch();
            this.innerHTML = '<i class="fas fa-play"></i>';
          }
          isRunning = !isRunning; // Toggle the running state
        });

        stopResetBtn.addEventListener('click', function () {
          stopStopwatch();
          // Reset your stopwatch logic here if required

          // Make sure the state reflects that the stopwatch is not running
          isRunning = false;
          startStopBtn.innerHTML = '<i class="fas fa-play"></i>';
        });

        function updateDisplay() {
          const totalSeconds = Math.floor(elapsedTime / 1000);
          let hours = Math.floor(totalSeconds / 3600);
          let minutes = Math.floor((totalSeconds % 3600) / 60);
          let seconds = totalSeconds % 60;
          let milliseconds = elapsedTime % 1000;

          let timeString = "";

          if (hours > 0) {
            timeString += `${hours.toString().padStart(2, '0')}:`;
          }
          timeString += `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
          if (hours === 0) {
            timeString += `:${milliseconds.toString().padStart(3, '0').substr(0, 2)}`; // Only display first two digits of milliseconds
          }

          document.getElementById('stopwatchDisplay').textContent = timeString;
        }

        function startStopwatch() {
          if (isStopwatchRunning) return; // Already running

          isStopwatchRunning = true;
          hasTimeElapsed = true;

          const startTime = Date.now() - elapsedTime;
          stopwatchInterval = setInterval(() => {
            elapsedTime = Date.now() - startTime;
            updateDisplay();
          }, 1);

          // Change start icon to pause icon
          document.getElementById('startStopBtn').innerHTML = '<i class="fas fa-pause"></i>';

          // Make sure stop/reset button shows the stop icon
          document.getElementById('stopResetBtn').innerHTML = '<i class="fas fa-stop"></i>';
        }

        function stopOrResetStopwatch() {
          if (isStopwatchRunning) {
            stopStopwatch();
          } else if (hasTimeElapsed && !isStopwatchRunning) {
            resetStopwatch();
          }
        }

        function stopStopwatch() {
          clearInterval(stopwatchInterval);
          isStopwatchRunning = false;

          // Change pause icon to play icon
          document.getElementById('startStopBtn').innerHTML = '<i class="fas fa-play"></i>';

          // If time has elapsed, change stop icon to reset icon
          if (hasTimeElapsed) {
            document.getElementById('stopResetBtn').innerHTML = '<i class="fas fa-undo-alt"></i>';
          }
        }

        function resetStopwatch() {
          elapsedTime = 0;
          updateDisplay();
          hasTimeElapsed = false;

          // Change reset icon back to stop icon
          document.getElementById('stopResetBtn').innerHTML = '<i class="fas fa-stop"></i>';
        }

        let timer;
        let isTimerRunning = false;

        document.getElementById('startTimerBtn').addEventListener('click', function () {
          if (!isTimerRunning) {
            isTimerRunning = true;
            startTimer();
          }
        });

        document.getElementById('stopTimerBtn').addEventListener('click', function () {
          isTimerRunning = false;
          clearInterval(timer);
        });

        document.getElementById('resetTimerBtn').addEventListener('click', function () {
          isTimerRunning = false;
          clearInterval(timer);
          resetTimer();
        });

        document.getElementById('logSlider').addEventListener('input', function () {
          let sliderValue = parseFloat(this.value);
          let timeInSeconds = Math.exp((sliderValue / 10000) * Math.log(86401) / 96) - 1; // 86400 seconds in 24 hours

          let hours = Math.floor(timeInSeconds / 3600);
          let minutes = Math.floor((timeInSeconds - hours * 3600) / 60);
          let seconds = Math.floor(timeInSeconds - hours * 3600 - minutes * 60);

          let timerTime = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
          document.getElementById('timerHours').textContent = timerTime;
          if (displayOptionGlobal === 'timer') {
            document.getElementById('displayContent').textContent = timerTime;
          }
        });

        function startTimer(start = true) {
          let timerTime = document.getElementById('timerHours').textContent;
          let parts = timerTime.split(':');
          let hours = parseInt(parts[0], 10);
          let minutes = parseInt(parts[1], 10);
          let seconds = parseInt(parts[2], 10);
          if (start) {
            timer = setInterval(function () {
              if (seconds > 0) {
                seconds--;
              } else if (minutes > 0) {
                minutes--;
                seconds = 59;
              } else if (hours > 0) {
                hours--;
                minutes = 59;
                seconds = 59;
              } else {
                clearInterval(timer);
                alert('Timer Finished!');
              }
              let timerTime = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
              document.getElementById('timerHours').textContent = timerTime;
              document.getElementById('displayTimerOption').textContent = timerTime;
              if (displayOptionGlobal === 'timer') {
                document.getElementById('displayContent').textContent = timerTime;
              }
            }, 1000);
          } else {
            let timerTime = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
            document.getElementById('timerHours').textContent = timerTime;
            document.getElementById('displayTimerOption').textContent = timerTime;
            if (displayOptionGlobal === 'timer') {
              document.getElementById('displayContent').textContent = timerTime;
            }
          }
        }

        function resetTimer() {
          document.getElementById('timerHours').textContent = '00:00:00';
        }

        // Function to fetch the weather text (either "main" or "description")
        function getWeatherText(iconBool, descriptionBool, elementId, hyphen = false) {
          return new Promise((resolve, reject) => {

            var lat = parseFloat(localStorage.getItem('userLatitude'));
            var lon = parseFloat(localStorage.getItem('userLongitude'));
            let apiKey = localStorage.getItem('weatherApiKey');
            var url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}`;

            fetch(url)
              .then(response => response.json())
              .then(data => {
                var weatherCode = data.weather[0].id;
                var description = data.weather[0].description;
                var main = data.weather[0].main;
                var iconClass = 'wi wi-owm-' + weatherCode;

                var output = "";
                if (iconBool) output += `<i class="${iconClass}"></i>`;
                output += hyphen ? '-' : ' ';
                output += descriptionBool ? description :  main;
                resolve(output);
              })
              .catch(error => {
                console.error('Error fetching weather data:', error);
                reject(error);
              });

          });
        }

        // Function to apply the weather text to a specified element
        function applyWeatherDisplay(text, elementId) {
          document.getElementById(elementId).innerHTML = text;
        }

        // Function to update the weather display every hour
        function updateWeatherDisplay(iconBool, descriptionBool, elementId, hyphen) {
          //var elementId = 'weather-display'; // ID of the element where the weather information will be displayed
          //var iconBool = true; // Example value
          //var descriptionBool = true; // Example value

          // Fetch and apply the weather information
          getWeatherText(iconBool, descriptionBool,'',hyphen).then(text => {
            applyWeatherDisplay(text, elementId);
          });

          // Schedule the function to run every hour
          setInterval(() => {
            getWeatherText(iconBool, descriptionBool,'',hyphen).then(text => {
              applyWeatherDisplay(text, elementId);
            });
          }, 3600000); // 3600000 milliseconds = 1 hour
        }

        // Call the function to start updating the weather display
        updateWeatherDisplay(true, false, 'weather-display');

        function getStoredLocation() {
          const latitude = 28.7744; //parseFloat(localStorage.getItem('userLatitude'));
          const longitude = -100.4917; //parseFloat(localStorage.getItem('userLongitude'));

          if (!isNaN(latitude) && !isNaN(longitude)) {
            return {
              latitude,
              longitude
            };
          }
          return null;
        }

        function getRainChance(iconBool, hyphen, elementId) {
          const lat = parseFloat(localStorage.getItem('userLatitude'));
          const lon = parseFloat(localStorage.getItem('userLongitude'));
          let apiKey = localStorage.getItem('weatherApiKey');

          // Using the forecast endpoint for the specified latitude and longitude
          const weatherUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}`;

          fetch(weatherUrl)
            .then(response => response.json())
            .then(data => {
              let rainChance = -1; // Base rain chance indicating error
              rainChance = data.list[0].pop * 100

              // Construct the output string
              let output = rainChance === -1 ? "Error" : `${rainChance}%`;
              if (hyphen) {
                output = `-` + output;
              } else {
                output = ` ` + output;
              }
              if (iconBool) {
                output = `<i class="wi wi-rain"></i>` + output;
              }

              document.getElementById(elementId).innerHTML = output;
            })
            .catch(error => {
              console.error(`Error fetching rain chance data: ${error}`);
            });
        }

        function getTemperature(iconBool, elementId, hyphen = false) {
          const lat = parseFloat(localStorage.getItem('userLatitude'));
          const lon = parseFloat(localStorage.getItem('userLongitude'));

          // Your OpenWeatherMap API key
          let apiKey = localStorage.getItem('weatherApiKey');

          // Construct the API URL for the weather
          const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}`;

          // Fetch weather data
          fetch(weatherUrl)
            .then(response => response.json())
            .then(data => {
              const temperature = (data.main.temp - 273.15) * 9 / 5 + 32; // Temperature in f (OpenWeatherMap returns temperature in Kelvin)

              // Construct the output string
              let output = ``;

              if (iconBool) {
                // Here you can add the appropriate icon code based on the weather data
                output = hyphen ? `<i class="wi wi-thermometer"></i>-` + output : `<i class="wi wi-thermometer"></i> ` + output; // Example: Erik Flowers weather icon for thermometer
              }

                output += `${temperature.toFixed(1)}` + 'F';


              // Set the innerHTML of the display element
              document.getElementById(elementId).innerHTML = output;
            })
            .catch(error => {
              console.error(`Error fetching temperature data: ${error}`);
            });
        }
        console.log(getTemperature(true, true));

        document.getElementById('weatherApiKey').addEventListener('input', function () {
          let apiKey = this.value;
          localStorage.setItem('weatherApiKey', apiKey);

          // Store the API key to use it in your API calls
        });



        function updateDisplayContent(option) {
          const displayContent = document.getElementById('displayContent');
          switch (option) {
          case 'time':
            updateTimeSmall(); // Update the time content
            break;
          case 'timer':
            startTimer(false);
            break;
          case 'weather':
            // Fetch and update the weather content here
            getWeatherText(true, false, 'displayContent')
              .then(weatherText => {
                displayContent.innerHTML = weatherText;
              })
              .catch(error => {
                console.error('Error fetching weather:', error);
                displayContent.innerHTML = '<i class="wi wi-na"></i> Weather Unavailable';
              });
            break;
          case 'rain':
            // Fetch and update the weather content here
            getRainChance(true, false, 'displayContent');
            break;
          case 'temp':
            // Fetch and update the weather content here
            getTemperature(true, 'displayContent');
            break;
          case 'date':
            // Fetch and update the weather content here
                getDate(0, 1, 1, 0, 1).then(result => {
                    document.getElementById('displayContent').innerHTML = result;
                });
            break;
          default:
            break;
          }
        }

        // Function to request and store location permission status
        function requestLocationPermission() {
          let locationPermission;
          locationPermission = localStorage.getItem('locationPermission');
          if (locationPermission === 'true') {
            localStorage.setItem('locationPermission', false);
            requestLocation();
            console.log("did work")
          } else if (locationPermission === 'false') {} else {
            console.log("didn't work")
            localStorage.setItem('locationPermission', false);
            requestLocation();
          }
        }

        function requestLocation() {
          navigator.permissions.query({
            name: 'geolocation'
          }).then(permissionStatus => {
            navigator.geolocation.getCurrentPosition(position => {
              const {
                latitude,
                longitude
              } = position.coords;
              localStorage.setItem('locationPermission', false);
              localStorage.setItem('userLatitude', latitude);
              localStorage.setItem('userLongitude', longitude);
            }, () => {
              //if denied
            });
          });
        }

        document.getElementById('updateLocationBtn').addEventListener('click', requestLocation);

        startTimer(false);

        function fetchAllData() {
          // Call each of your weather functions
          getTemperature(true, 'temperature-display');
          getTemperature(true, 'displayTempOption', true);
          getRainChance(true, false, 'rain-chance-display');
          getRainChance(true, true, 'displayRainOption');
          updateWeatherDisplay(true, true, 'weather-display');
          updateWeatherDisplay(true, false, 'displayWeatherOption', true);
          updateDisplayContent(displayOptionGlobal);
          getDate(0, 1, 1, 0, 1).then(result => {
              document.getElementById('displayDateOption').innerHTML = result;
          });
          getDate(0, 1, 1, 0, 1).then(result => {
              document.getElementById('currentDate').innerHTML = result;
          });
          // ... add more functions as needed
        }
        fetchAllData();
        setInterval(fetchAllData, 3600000);

          // Call each of your weather functions

          // ... add more functions as needed



        function generateShadow(hexColor, opacity, angle, distance, radius) {
            // Convert the hex color to RGB
            let [r, g, b] = hexToRGB(hexColor);

            // Calculate the horizontal and vertical offset using trigonometry
            let offsetX = Math.round(distance * Math.cos(angle * (Math.PI / 180)));
            let offsetY = Math.round(distance * Math.sin(angle * (Math.PI / 180)));

            let shadowValue = `${offsetX}px ${offsetY}px ${radius}px rgba(${r},${g},${b},${opacity})`;
            
            ['.screen-text-large', '.screen-text-medium'].forEach(selector => {
                document.querySelectorAll(selector).forEach(element => {
                    element.style.textShadow = shadowValue;
                });
            });
            return shadowValue;
        }

        console.log(generateShadow('#000000',0,0,0,0));

        // Define a function to apply the shadow based on current input values
        function applyShadowFromInputs() {
            let color = document.getElementById('shadowColor').value;
            let opacity = parseFloat(document.getElementById('shadowOpacity').value);
            let angle = parseFloat(document.getElementById('shadowAngle').value);
            let distance = parseFloat(document.getElementById('shadowDistance').value);
            let radius = parseFloat(document.getElementById('shadowRadius').value);

            // Apply the shadow using the provided settings
            generateShadow(color, opacity, angle, distance, radius);
        }


        function debounce(func, wait) {
            let timeout;

            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };

                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function applyStylesFromInputs() {
            let color = document.getElementById('shadowColor').value;
            let opacity = parseFloat(document.getElementById('shadowOpacity').value);
            let angle = parseFloat(document.getElementById('shadowAngle').value);
            let distance = parseFloat(document.getElementById('shadowDistance').value);
            let radius = parseFloat(document.getElementById('shadowRadius').value);

            // Apply the shadow using the provided settings
            generateShadow(color, opacity, angle, distance, radius);

            // Bold
            let isBold = document.getElementById('textBold').checked;
            document.querySelectorAll('.screen-text-large, .screen-text-medium').forEach(elem => {
                elem.style.fontWeight = isBold ? 'bold' : 'normal';
            });

            // Character Spacing
            let charSpacing = document.getElementById('characterSpacing').value + 'px';
            document.querySelectorAll('.screen-text-large, .screen-text-medium').forEach(elem => {
                elem.style.letterSpacing = charSpacing;
            });

            // Text Size Multiplier
            let sizeMultiplierLarge = document.getElementById('textSizeMultiplier').value;
            document.querySelectorAll('.screen-text-large').forEach(elem => {
                elem.style.fontSize = `calc(var(--baseFontSizeLarge) * ${sizeMultiplierLarge})`; 
            });

            // Text Size Multiplier
            let sizeMultiplierMedium = document.getElementById('textSizeMultiplier').value;
            document.querySelectorAll('.screen-text-medium').forEach(elem => {
                elem.style.fontSize = `calc(var(--baseFontSizeMedium) * ${sizeMultiplierMedium})`; 
            });

            // Text Opacity
            let textOpacity = document.getElementById('textOpacity').value;
            document.querySelectorAll('.screen-text-large, .screen-text-medium').forEach(elem => {
                elem.style.opacity = textOpacity;
            }); //to each input's change event

            shouldUse24HourG = document.getElementById('use24hrs').checked;
            shouldIncludeSecondsG = document.getElementById('useSeconds').checked;
            truncateLeadingZeroG = document.getElementById('truncateZero').checked;
            updateTime();

        }
        const inputElements = ['shadowColor', 'shadowOpacity', 'shadowAngle', 'shadowDistance', 'shadowRadius', 'textBold', 'characterSpacing', 'textSizeMultiplier', 'textOpacity', 'useSeconds', 'use24hrs', 'truncateZero'];


        inputElements.forEach(id => {
            document.getElementById(id).addEventListener('input', applyStylesFromInputs);
        });

        function saveSettingsToLocalStorage() {
            const settings = {
                mainColor: document.getElementById('mainColorPicker').value,
                alternateColor: document.getElementById('textColorPicker').value,
                bgColor: document.getElementById('bgColorPicker').value,
                textBold: document.getElementById('textBold').checked,
                characterSpacing: document.getElementById('characterSpacing').value,
                textSizeMultiplier: document.getElementById('textSizeMultiplier').value,
                textOpacity: document.getElementById('textOpacity').value,
                selectedFont: document.getElementById('font').value,
                shadowColor: document.getElementById('shadowColor').value,
                shadowOpacity: document.getElementById('shadowOpacity').value,
                shadowAngle: document.getElementById('shadowAngle').value,
                shadowDistance: document.getElementById('shadowDistance').value,
                shadowRadius: document.getElementById('shadowRadius').value,
                use24Hour: document.getElementById('use24hrs').checked,
                includeSeconds: document.getElementById('useSeconds').checked,
                leadingZero: document.getElementById('truncateZero').checked,
                enableDate: document.getElementById('toggleDate').checked,
                useCommas: document.getElementById('toggleSep').checked,
                dateFormat: document.querySelector('input[name="dateFormat"]:checked').value,
                weekFormat: document.querySelector('input[name="weekdayFormat"]:checked').value,
                monthFormat: document.querySelector('input[name="monthFormat"]:checked').value,
                yearFormat: document.querySelector('input[name="yearFormat"]:checked').value,

            };
    
            localStorage.setItem('userSettings', JSON.stringify(settings));
            console.log(settings);
        }
        saveSettingsToLocalStorage();


        function loadSettingsFromLocalStorage() {
            const savedSettings = localStorage.getItem('userSettings');

            if (savedSettings) {
                const settings = JSON.parse(savedSettings);

                // Set values of the input fields
                document.getElementById('mainColorPicker').value = settings.mainColor;
                document.getElementById('textColorPicker').value = settings.alternateColor;
                document.getElementById('bgColorPicker').value = settings.bgColor;
                document.getElementById('textBold').checked = settings.textBold;
                document.getElementById('characterSpacing').value = settings.characterSpacing;
                document.getElementById('textSizeMultiplier').value = settings.textSizeMultiplier;
                document.getElementById('textOpacity').value = settings.textOpacity;
                document.getElementById('font').value = settings.selectedFont;
                document.getElementById('shadowColor').value = settings.shadowColor;
                document.getElementById('shadowOpacity').value = settings.shadowOpacity;
                document.getElementById('shadowAngle').value = settings.shadowAngle;
                document.getElementById('shadowDistance').value = settings.shadowDistance;
                document.getElementById('shadowRadius').value = settings.shadowRadius;

                document.getElementById('toggleDate').checked = settings.enableDate;
                document.getElementById('toggleSep').checked = settings.useCommas;
                document.querySelector(`input[name="dateFormat"][value="${settings.dateFormat}"]`).checked = true;
                document.querySelector(`input[name="weekdayFormat"][value="${settings.weekFormat}"]`).checked = true;
                document.querySelector(`input[name="monthFormat"][value="${settings.monthFormat}"]`).checked = true;
                document.querySelector(`input[name="yearFormat"][value="${settings.yearFormat}"]`).checked = true;

                document.getElementById('use24hrs').checked = settings.use24Hour;
                document.getElementById('useSeconds').checked = settings.includeSeconds;
                document.getElementById('truncateZero').checked = settings.leadingZero;

                shouldUse24HourG = document.getElementById('use24hrs').checked;
                shouldIncludeSecondsG = document.getElementById('useSeconds').checked;
                truncateLeadingZeroG = document.getElementById('truncateZero').checked;
                updateTime();

                // If using select2, you might need to trigger an update for the dropdown after changing its value
                $('#font').trigger('change');

                // Apply loaded settings to the elements
                const elementsLarge = document.querySelectorAll('.screen-text-large');
                const elementsMedium = document.querySelectorAll('.screen-text-medium');


                toVariable('--main-color', settings.mainColor);
                toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81))
                toVariable('--text-color', settings.alternateColor);
                toVariable('--text-lighter', hexVarMix('#ffffff', '--text-color', 0.81));
                toVariable('--text-faded', varMix('--main-color', '--text-color', 0.81));
                toVariable('--main-bg-color', settings.bgColor);
                toVariable('--main-bg-lighter', hexVarMix('#ffffff', '--main-bg-color', 0.81));

                
                shouldUse24HourG = settings.use24Hour;
                shouldIncludeSecondsG = settings.includeSeconds;
                truncateLeadingZeroG = settings.leadingZero;
                updateTime();

                elementsLarge.forEach(element => {
                    applySettingsToElement(element, settings);
                });
        
                elementsMedium.forEach(element => {
                    applySettingsToElement(element, settings);
                });
            }
        }

        function applySettingsToElement(element, settings) {
            let elementsLarge = document.querySelectorAll('.screen-text-large');
            let elementsMedium = document.querySelectorAll('.screen-text-medium');
            // Applying font, bold, character spacing, text size multiplier, and opacity
            console.log(settings.selectedFont);
            element.style.fontFamily = settings.selectedFont;
            element.style.fontWeight = settings.textBold ? 'bold' : 'normal';
            element.style.letterSpacing = settings.characterSpacing + 'px';
            element.style.opacity = settings.textOpacity;
            const sizeValueLarge = `calc(${settings.textSizeMultiplier} * var(--baseFontSizeLarge))`;
            const sizeValueMedium = `calc(${settings.textSizeMultiplier} * var(--baseFontSizeMedium))`;

            updateDateFromSelection();

            document.getElementById('use24hrs').checked = settings.use24Hour;
            document.getElementById('useSeconds').checked = settings.includeSeconds;
            document.getElementById('truncateZero').checked = settings.leadingZero;
            shouldUse24HourG = document.getElementById('use24hrs').checked;
            shouldIncludeSecondsG = document.getElementById('useSeconds').checked;
            truncateLeadingZeroG = document.getElementById('truncateZero').checked;
            updateTime();

            elementsLarge.forEach(element => {
                element.style.fontSize = sizeValueLarge;
            });

            elementsMedium.forEach(element => {
                element.style.fontSize = sizeValueMedium;
            });

            // Constructing the shadow
            const offsetX = Math.cos(settings.shadowAngle * (Math.PI / 180)) * settings.shadowDistance;
            const offsetY = Math.sin(settings.shadowAngle * (Math.PI / 180)) * settings.shadowDistance;
            const shadowColorRGB = hexToRGB(settings.shadowColor);
            const rgbaShadowColor = `rgba(${shadowColorRGB.r}, ${shadowColorRGB.g}, ${shadowColorRGB.b}, ${settings.shadowOpacity})`;
            element.style.textShadow = `${offsetX}px ${offsetY}px ${settings.shadowRadius}px ${rgbaShadowColor}`;
            updateStyles();
        }

        function saveSettingsToList(name) {
            // First, retrieve the current settings from the input elements
            const settings = {
                mainColor: document.getElementById('mainColorPicker').value,
                textColor: document.getElementById('textColorPicker').value,
                bgColor: document.getElementById('bgColorPicker').value,
                textBold: document.getElementById('textBold').checked,
                characterSpacing: document.getElementById('characterSpacing').value,
                textSizeMultiplier: document.getElementById('textSizeMultiplier').value,
                textOpacity: document.getElementById('textOpacity').value,
                selectedFont: document.getElementById('font').value,
                shadowColor: document.getElementById('shadowColor').value,
                shadowOpacity: document.getElementById('shadowOpacity').value,
                shadowAngle: document.getElementById('shadowAngle').value,
                shadowDistance: document.getElementById('shadowDistance').value,
                shadowRadius: document.getElementById('shadowRadius').value,
                use24Hour: document.getElementById('use24hrs').checked,
                includeSeconds: document.getElementById('useSeconds').checked,
                leadingZero: document.getElementById('truncateZero').checked,
                enableDate: document.getElementById('toggleDate').checked,
                useCommas: document.getElementById('toggleSep').checked,
                dateFormat: document.querySelector('input[name="dateFormat"]:checked').value,
                weekFormat: document.querySelector('input[name="weekdayFormat"]:checked').value,
                monthFormat: document.querySelector('input[name="monthFormat"]:checked').value,
                yearFormat: document.querySelector('input[name="yearFormat"]:checked').value,

            };

            // Then, retrieve the list of saved settings from localStorage (or create a new one if it doesn't exist)
            const savedSettingsList = JSON.parse(localStorage.getItem('settingsList')) || {};

            // Use the provided name as a key to save the current settings to the list
            savedSettingsList[name] = settings;

            // Finally, save the updated list back to localStorage
            localStorage.setItem('settingsList', JSON.stringify(savedSettingsList));

            // Update the dropdown
            updateSavedSettingsList();
        }
        function deleteSettingsFromList(name) {
            // Retrieve the list of saved settings from localStorage
            const savedSettingsList = JSON.parse(localStorage.getItem('settingsList'));

            // If the settings list is not null and contains the desired theme, delete it
            if (savedSettingsList && savedSettingsList[name]) {
                delete savedSettingsList[name];

                // Save the updated list back to localStorage
                localStorage.setItem('settingsList', JSON.stringify(savedSettingsList));
            } else {
                console.warn('Theme not found in the list.');
            }
        }

        function loadSettingsFromList(name) {
            // Retrieve the list of saved settings from localStorage
            const savedSettingsList = JSON.parse(localStorage.getItem('settingsList'));
    
            if (!savedSettingsList || !savedSettingsList[name]) {
                alert('No settings found for the provided name.');
                return;
            }

            const settings = savedSettingsList[name];

            // Set values of the input fields
            document.getElementById('mainColorPicker').value = settings.mainColor;
            document.getElementById('textColorPicker').value = settings.textColor;
            document.getElementById('bgColorPicker').value = settings.bgColor;
            document.getElementById('textBold').checked = settings.textBold;
            document.getElementById('characterSpacing').value = settings.characterSpacing;
            document.getElementById('textSizeMultiplier').value = settings.textSizeMultiplier;
            document.getElementById('textOpacity').value = settings.textOpacity;
            document.getElementById('font').value = settings.selectedFont;
            document.getElementById('shadowColor').value = settings.shadowColor;
            document.getElementById('shadowOpacity').value = settings.shadowOpacity;
            document.getElementById('shadowAngle').value = settings.shadowAngle;
            document.getElementById('shadowDistance').value = settings.shadowDistance;
            document.getElementById('shadowRadius').value = settings.shadowRadius;

            document.getElementById('toggleDate').checked = settings.enableDate;
            document.getElementById('toggleSep').checked = settings.useCommas;
            document.querySelector(`input[name="dateFormat"][value="${settings.dateFormat}"]`).checked = true;
            document.querySelector(`input[name="weekdayFormat"][value="${settings.weekFormat}"]`).checked = true;
            document.querySelector(`input[name="monthFormat"][value="${settings.monthFormat}"]`).checked = true;
            document.querySelector(`input[name="yearFormat"][value="${settings.yearFormat}"]`).checked = true;


            document.getElementById('use24hrs').checked = settings.use24Hour;
            document.getElementById('useSeconds').checked = settings.includeSeconds;
            document.getElementById('truncateZero').checked = settings.leadingZero;

            shouldUse24HourG = document.getElementById('use24hrs').checked;
            shouldIncludeSecondsG = document.getElementById('useSeconds').checked;
            truncateLeadingZeroG = document.getElementById('truncateZero').checked;
            updateTime();

            // If using select2, you might need to trigger an update for the dropdown after changing its value
            $('#font').trigger('change');

            // Apply loaded settings to the elements
            const elementsLarge = document.querySelectorAll('.screen-text-large');
            const elementsMedium = document.querySelectorAll('.screen-text-medium');

            toVariable('--main-color', settings.mainColor);
            toVariable('--main-lighter', hexVarMix('#ffffff', '--main-color', 0.81));
            toVariable('--text-color', settings.textColor);
            toVariable('--text-lighter', hexVarMix('#ffffff', '--text-color', 0.81));
            toVariable('--text-faded', varMix('--main-color', '--text-color', 0.81));
            toVariable('--main-bg-color', settings.bgColor);
            toVariable('--main-bg-lighter', hexVarMix('#ffffff', '--main-bg-color', 0.81));

            elementsLarge.forEach(element => {
                applySettingsToElement(element, settings);
            });

            elementsMedium.forEach(element => {
                applySettingsToElement(element, settings);
            });
        }
        loadSettingsFromList('default');




        const saveThemeBtn = document.getElementById('saveThemeBtn');

        saveThemeBtn.addEventListener('click', function() {
            const themeName = prompt("Enter a name for your theme:");

            // Check if the user pressed Cancel or entered an empty name
            if (themeName !== null && themeName.trim() !== "") {
                saveSettingsToList(themeName);
                alert('Theme saved successfully!');
            } else {
                alert('Please enter a valid name for your theme.');
            }
        });

        function updateSavedSettingsList() {
            // Get the savedSettingsList from localStorage
            const savedSettingsList = JSON.parse(localStorage.getItem('settingsList')) || {};

            // Get a reference to the dropdown
            const dropdown = document.getElementById('savedSettingsListDropdown');

            // Clear any existing options from the dropdown
            while (dropdown.firstChild) {
                dropdown.removeChild(dropdown.firstChild);
            }

            // Add each setting name as an option in the dropdown
            for (const name in savedSettingsList) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                dropdown.appendChild(option);
            }
        }
        document.addEventListener('DOMContentLoaded', updateSavedSettingsList);
        document.getElementById('savedSettingsListDropdown').addEventListener('change', function() {
            const selectedName = this.value;
            if (selectedName) {
                loadSettingsFromList(selectedName);
            }
        });

        document.getElementById('deleteThemeButton').addEventListener('click', function() {
            // Get the dropdown
            const dropdown = document.getElementById('savedSettingsListDropdown');
            console.log(dropdown);
            // Get the currently selected theme's name
            const selectedThemeName = dropdown.options[dropdown.selectedIndex].value;

            // Delete the theme using the delete function
            deleteSettingsFromList(selectedThemeName);

            // Refresh the dropdown
            updateSavedSettingsList();
        });

        function updateDateFromSelection() {
            // Check the checkboxes first
            if (!document.getElementById('toggleDate').checked) {
                document.getElementById('currentDate').textContent = ""; // Clear the date
                return; // Exit the function
            }
    
            const sep = document.getElementById('toggleSep').checked ? 1 : 0;

            const dateFormat = parseInt(document.querySelector('input[name="dateFormat"]:checked').value);
            const weekdayFormat = parseInt(document.querySelector('input[name="weekdayFormat"]:checked').value);
            const monthFormat = parseInt(document.querySelector('input[name="monthFormat"]:checked').value);
            const yearFormat = parseInt(document.querySelector('input[name="yearFormat"]:checked').value);
    
            getDate(weekdayFormat, dateFormat, monthFormat, yearFormat, sep).then(formattedDate => {
                document.getElementById('currentDate').textContent = formattedDate;
            });
        }

        // We want to call updateDateFromSelection when any of the radio buttons or checkboxes change.
        const controls = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
        controls.forEach(control => {
            control.addEventListener('change', updateDateFromSelection);
            control.addEventListener('change', applyStylesFromInputs);
        });

        // Call immediately upon page load to set the initial format
        updateDateFromSelection();






    function drawClock() {
        var canvas = document.getElementById('clock');
        var ctx = canvas.getContext('2d');
        var radius = canvas.height / 2;
        ctx.translate(radius, radius);
        radius = radius * 0.9;
        setInterval(drawFace, 1000);
    }

    function drawFace() {
        var canvas = document.getElementById('clock');
        var ctx = canvas.getContext('2d');
        var radius = canvas.height / 2;
        var now = new Date();
        var hour = now.getHours();
        var minute = now.getMinutes();
        var second = now.getSeconds();
        // Clear the canvas
        ctx.clearRect(-500, -500, 1000, 1000);

        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, 2 * Math.PI);
        ctx.fillStyle = 'white';
        ctx.fill();
        // Draw the clock face
        drawTime(ctx, radius, hour % 12, minute, second);
    }

    function drawTime(ctx, radius, hour, minute, second) {

        // Second hand
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.rotate(second * (Math.PI / 30));
        ctx.lineTo(0, -radius * 0.9);
        ctx.strokeStyle = '#aaaaaa';
        ctx.stroke();
        ctx.rotate(-second * (Math.PI / 30));

        // Hour hand
        ctx.beginPath();
        ctx.lineWidth = radius * 0.08;
        ctx.lineCap = "round";
        ctx.moveTo(0, 0);
        ctx.rotate(hour * (Math.PI / 6));
        ctx.lineTo(0, -radius * 0.5);
        ctx.strokeStyle = '#000000';
        ctx.stroke();
        ctx.rotate(-hour * (Math.PI / 6));
        ctx.lineWidth = 1;

        // Minute hand
        ctx.beginPath();
        ctx.lineWidth = radius * 0.07;
        ctx.moveTo(0, 0);
        ctx.rotate(minute * (Math.PI / 30));
        ctx.lineTo(0, -radius * 0.7);
        ctx.strokeStyle = '#000000';
        ctx.stroke();
        ctx.rotate(-minute * (Math.PI / 30));
        ctx.lineWidth = 1;
    }

    function updateFavicon() {
        var canvas = document.getElementById('clock');
        var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
        link.type = 'image/x-icon';
        link.rel = 'shortcut icon';
        link.href = canvas.toDataURL('image/png');
        document.getElementsByTagName('head')[0].appendChild(link);
    }

    drawClock();
    setInterval(updateFavicon, 1000);
    </script>  
</body>

</html>
